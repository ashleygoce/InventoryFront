<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>In Store</title>
    <style>
        body {
            margin: 0;
            padding: 0;
            font-family: Arial, sans-serif;
            background-color: #0D1321;
            color: #ffffff;
            overflow-x: hidden; /* Hide horizontal scrollbar */
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            gap: 20px;
            padding-top: 20px; /* Adjusted */
        }

        h1 {
            font-weight: bold;
            text-align: center;
            width: 100%;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-bottom: 20px;
            font-size: 24px;
        }

        .header {
            width: 100%;
            max-width: 100vw;
            overflow-x: hidden; /* Hide horizontal overflow within header */
        }

        .back-button {
            position: absolute;
            top: 49px;
            left: 30px;
            cursor: pointer;
        }

        .back-button img {
            width: 30px;
            height: 30px;
        }

        .logo-container {
            display: flex;
            justify-content: center;
            align-items: center;
            margin-bottom:10px; /* Add margin-bottom to create space */
        }

        .logo-text {
            position: relative;
            font-size: 33px;
            font-weight: bold;
            text-transform: uppercase;
        }

        .overview-count {
            display: flex;
            justify-content: center;
            margin-top: 30px; /* Adjusted margin-top */
            margin-left: 45px; /* Added margin-left to move it to the left */
        }

        .item-count,
        .total-quantity {
            color: #ffffff;
            font-size: 20px; /* Bigger font size */
            font-weight: bold; /* Bold text */
            display: flex;
            flex-direction: column; /* Arrange text and count vertically */
            align-items: center; /* Align text and count horizontally */
            margin-right: 40px; /* Added space between "Items" and "Total Quantity" */
        }

        .product-container {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 20px;
            justify-content: center;
            max-width: 90%; /* Adjusted for smaller screens */
            margin: 0 auto;
            margin-top: 5px; /* Add margin-top to create space */
        }

        .product-card {
            position: relative;
            background-color: #1E212D;
            border-radius: 10px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            text-align: left;
            width: 150px;
            height: 150px;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: flex-start;
            padding: 10px;
            margin-left: 5px;
            transition: transform 0.3s ease; /* Added transition for smooth effect */
        }

        .product-card:hover {
            transform: scale(1.05); /* Increase scale on hover for a slight zoom effect */
        }

        .product-title {
            font-size: 15px;
            margin-bottom: 5px;
            font-weight: bold; /* Make the product title bold */
            text-transform: uppercase; /* Convert the text to uppercase */
        }

        .product-quantity {
            font-size: 32px;
            font-weight: bold; /* Make the product title bold */
            cursor: pointer;
        }

        .search-add-container {
            display: flex;
            align-items: center;
        }

        .search-add-image {
            width: 25px;
            height: auto;
            margin-left: 10px;
            cursor: pointer;
        }

        .modal {
            display: none;
            position: fixed;
            z-index: 1;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            overflow: auto;
            background-color: rgba(0, 0, 0, 0.5);
        }

        .modal-content {
            background-color: #1E212D;
            margin: auto; /* Set margin to auto to horizontally center */
            margin-top: 15%; /* Adjusted margin for vertical centering */
            padding: 15px; /* Reduced padding */
            border: 1px solid #888;
            width: 70%; /* Adjusted width to 70% */
            max-width: 600px; /* Increased maximum width */
            border-radius: 10px;
            color: #ffffff;
        }

        .close {
            color: #aaa;
            float: right;
            font-size: 28px;
            font-weight: bold;
        }

        .close:hover,
        .close:focus {
            color: #fff;
            text-decoration: none;
            cursor: pointer;
        }

        .edit-button {
            position: absolute;
            top: 0px; /* Adjusted top position */
            left: 125px; /* Moved to the left */
            width: 35px; /* Reduced width */
            height: 35px; /* Reduced height */
            cursor: pointer;
        }

        .dropdown-content {
            display: none;
            position: absolute;
            background-color: #1E212D;
            min-width: 120px;
            box-shadow: 0px 8px 16px 0px rgba(0,0,0,0.2);
            z-index: 1;
        }

        .dropdown-content a {
            color: #ffffff;
            padding: 12px 16px;
            text-decoration: none;
            display: block;
        }

        .dropdown-content a:hover {
            background-color: #555;
        }

        .dropdown:hover .dropdown-content {
            display: block;
        }
    </style>
</head>
<body>
    <div class="header">
        <div class="back-button">
            <a href="products.html">
                <img src="Icons/back.png" alt="Back">
            </a>
        </div>
        <h1>
            <div class="logo-container">
                <span class="logo-text" style="position: relative; top: 10px; left: -12px;">In Store</span>
            </div>
            <span class="search-add-container">
                <img src="Icons/searchP.png" alt="Search" class="search-add-image" onclick="openModal('search')">
                <img src="Icons/addP.png" alt="Add" class="search-add-image" onclick="openModal('addProduct')">
            </span>
        </h1>
        <div class="overview-count">
            <div class="item-count">Items <span id="itemCount">0</span></div>
            <div class="total-quantity">Total Quantity <span id="totalQuantity">0</span></div>
        </div>
    </div>
    <div class="product-container" id="productContainer">
        <!-- New product cards will be added here -->
    </div>
    <div id="myModal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeModal()">&times;</span>
            <h2>Add Product</h2>
            <form id="productForm">
                <label for="productName">Product Name:</label><br>
                <input type="text" id="productName" name="productName" required><br>
                <label for="quantity">Quantity:</label><br>
                <input type="number" id="quantity" name="quantity" required><br>
                <input type="submit" value="Add">
            </form>
        </div>
    </div>
    
    <div id="editModal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeEditModal()">&times;</span>
            <h2>Edit Product</h2>
            <form id="editProductForm">
                <input type="hidden" id="editProductIndex">
                <label for="editProductName">Product Name:</label><br>
                <input type="text" id="editProductName" name="editProductName" required><br>
                <label for="editQuantity">Quantity:</label><br>
                <input type="number" id="editQuantity" name="editQuantity" required><br>
                <input type="submit" value="Update">
                <input type="button" value="Delete" onclick="openDeleteWarningModal()">
            </form>
        </div>
    </div>

    <div id="deleteWarningModal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeDeleteWarningModal()">&times;</span>
            <h2>Delete Product</h2>
            <p>Are you sure you want to delete this product?</p>
            <button onclick="deleteProduct()">Yes</button>
            <button onclick="closeDeleteWarningModal()">No</button>
        </div>
    </div>

   <script>

    let products = [];
    let currentEditIndex = -1;

    document.addEventListener('DOMContentLoaded', fetchProducts);

function fetchProducts() {
    // fetch('fetch_products.php')
    //     .then(response => response.json())
    //     .then(data => {
    //         products = data;
    //         refreshProductList();
    //         updateProductCount();
    //     });

    // Static mock data for UI demo
    products = [
        {id: 1, name: "Shoes", quantity: 15},
        {id: 2, name: "Bags", quantity: 5},
        {id: 3, name: "Hats", quantity: 0}
    ];
    refreshProductList();
    updateProductCount();
}


function addProductToDOM(product, index) {
    const productContainer = document.getElementById('productContainer');
    const productCard = document.createElement('div');
    productCard.classList.add('product-card');

    const productTitle = document.createElement('div');
    productTitle.classList.add('product-title');
    productTitle.textContent = product.name;
    productCard.appendChild(productTitle);

    const productQuantity = document.createElement('div');
    productQuantity.classList.add('product-quantity');
    productQuantity.textContent = product.quantity;
    productQuantity.onclick = () => {
        if (parseInt(product.quantity) > 0) {
            product.quantity = parseInt(product.quantity) - 1; // Decrease quantity by 1
console.log("Quantity updated locally only.");
            refreshProductList(); // Update the product list
            updateProductCount(); // Update the total quantity count
        }
    };
    productCard.appendChild(productQuantity);

    const editButton = document.createElement('img');
    editButton.src = 'Icons/more1.png';
    editButton.classList.add('edit-button');
    editButton.onclick = () => openEditModal(index);
    productCard.appendChild(editButton);

    // Add condition to change background and text color
    if (parseInt(product.quantity) === 0) {
        productCard.style.backgroundColor = 'rgb(239, 58, 93)';
        productTitle.style.color = 'rgb(114, 2, 24)';
        productQuantity.style.color = 'rgb(114, 2, 24)';
    } else if (parseInt(product.quantity) <= 50) {
        productCard.style.backgroundColor = 'rgb(248, 171, 108)';
        productTitle.style.color = 'rgb(180, 81, 0)';
        productQuantity.style.color = 'rgb(180, 81, 0)';
    } else {
        productCard.style.backgroundColor = 'rgb(139, 207, 177)';
        productTitle.style.color = 'rgb(29, 76, 79)';
        productQuantity.style.color = 'rgb(29, 76, 79)';
    }

    productContainer.appendChild(productCard);
}

function updateProductQuantityInDatabase(productId, newQuantity) {
    fetch('updateclick.php', {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json'
        },
        body: JSON.stringify({ id: productId, quantity: newQuantity })
    })
    .then(response => response.json())
    .then(data => {
        if (!data.success) {
            console.error('Failed to update product quantity in the database.');
        }
    })
    .catch(error => {
        console.error('Error updating product quantity in the database:', error);
    });
}


    function refreshProductList(filteredProducts = products) {
        const productContainer = document.getElementById('productContainer');
        productContainer.innerHTML = '';
        filteredProducts.forEach((product, index) => addProductToDOM(product, index));
    }

    function updateProductCount() {
        const itemCount = products.length;
        const totalQuantity = products.reduce((sum, product) => sum + parseInt(product.quantity), 0);
        document.getElementById('itemCount').textContent = itemCount;
        document.getElementById('totalQuantity').textContent = totalQuantity;
    }

    function openModal(type) {
        const modal = document.getElementById('myModal');
        const modalContent = modal.querySelector('.modal-content');

        if (type === 'addProduct') {
            modalContent.querySelector('h2').textContent = 'Add Product';
            document.getElementById('productForm').reset();
            modal.style.display = 'block';
        } else if (type === 'search') {
            const searchQuery = prompt('Enter product name to search:');
            if (searchQuery) {
                const filteredProducts = products.filter(product =>
                    product.name.toLowerCase().includes(searchQuery.toLowerCase())
                );
                refreshProductList(filteredProducts);
            }
        }
    }

    function closeModal() {
        document.getElementById('myModal').style.display = 'none';
    }

    function openEditModal(index) {
        currentEditIndex = index;
        const product = products[index];
        document.getElementById('editProductIndex').value = index;
        document.getElementById('editProductName').value = product.name;
        document.getElementById('editQuantity').value = product.quantity;
        document.getElementById('editModal').style.display = 'block';
    }

    function closeEditModal() {
        document.getElementById('editModal').style.display = 'none';
    }

    function openDeleteWarningModal() {
        document.getElementById('deleteWarningModal').style.display = 'block';
    }

    function closeDeleteWarningModal() {
        document.getElementById('deleteWarningModal').style.display = 'none';
    }

    document.getElementById('productForm').addEventListener('submit', function(event) {
        event.preventDefault();
        const productName = document.getElementById('productName').value;
        const quantity = parseInt(document.getElementById('quantity').value);
        const newProduct = { name: productName, quantity: quantity };

        fetch('add_product.php', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json'
            },
            body: JSON.stringify(newProduct)
        })
        .then(response => response.json())
        .then(data => {
            if (data.success) {
                newProduct.id = data.id; // Assuming the PHP returns the new product ID
                products.push(newProduct);
                refreshProductList();
                updateProductCount();
                closeModal();
                document.getElementById('productForm').reset();
            } else {
                alert('Error adding product: ' + data.error);
            }
        });
    });

    document.getElementById('editProductForm').addEventListener('submit', function(event) {
        event.preventDefault();
        const index = parseInt(document.getElementById('editProductIndex').value);
        const productName = document.getElementById('editProductName').value;
        const quantity = parseInt(document.getElementById('editQuantity').value);

        const updatedProduct = { ...products[index], name: productName, quantity: quantity };

        fetch('edit_product.php', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json'
            },
            body: JSON.stringify(updatedProduct)
        })
        .then(response => response.json())
        .then(data => {
            if (data.success) {
                products[index] = updatedProduct;
                refreshProductList();
                updateProductCount();
                closeEditModal();
            } else {
                alert('Error editing product: ' + data.error);
            }
        });
    });

    function deleteProduct() {
        const productId = products[currentEditIndex].id;

        fetch('delete_product.php', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json'
            },
            body: JSON.stringify({ id: productId })
        })
        .then(response => response.json())
        .then(data => {
            if (data.success) {
                products.splice(currentEditIndex, 1);
                refreshProductList();
                updateProductCount();
                closeDeleteWarningModal();
                closeEditModal();
            } else {
                alert('Error deleting product: ' + data.error);
            }
        });
    }

    window.onclick = function(event) {
        const modal = document.getElementById('myModal');
        const editModal = document.getElementById('editModal');
        const deleteWarningModal = document.getElementById('deleteWarningModal');
        if (event.target == modal) {
            closeModal();
        } else if (event.target == editModal) {
            closeEditModal();
        } else if (event.target == deleteWarningModal) {
            closeDeleteWarningModal();
        }
    }
</script>
</body>
</html>
